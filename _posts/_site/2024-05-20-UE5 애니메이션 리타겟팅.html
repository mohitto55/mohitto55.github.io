<h1 id="개요">개요</h1>
<p>언리얼 마켓플레이스나 Mixamo를 둘러보다 보면 좋은 애니메이션들이 많다. 
찾은 애니메이션을 다른 Skeleton에 적용시키려고하면 Skeleton이 일치하지 않아 사용할 수 없는데 Animation Retargeting은 다른 Skeleton에 애니메이션을 사용할 수 있게 만들어주는 기능이다.</p>

<h1 id="mixamo-에셋-가져오기">Mixamo 에셋 가져오기</h1>
<h2 id="원하는-캐릭터로-애니메이션-가져오기">원하는 캐릭터로 애니메이션 가져오기</h2>
<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/1f453bb3-eb17-4157-a4d3-e23b0a7ab833" alt="image" /></p>
<blockquote>
  <p>Mixamo캐릭터에서 원하는 메시를 고른다.</p>
</blockquote>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/9af49e37-74fa-4863-ad66-48b3d37b0dc9" alt="image" /></p>

<h1 id="리타겟팅">리타겟팅</h1>
<h2 id="54-이상">5.4 이상</h2>
<ul>
  <li>5.4 버전부터는 자동으로 애니메이션 리타겟팅이 가능하다.</li>
  <li>하지만 규격이 너무 다르면 부자연스럽기에 수동으로 하는 방식을 추천한다. 
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/fb055d90-6790-4818-a3db-f278c7b9c5a9" alt="image" /></li>
</ul>

<h2 id="53-이하">5.3 이하</h2>
<p>언리얼 엔진에서의 애니메이션은 타겟팅한 스켈레톤 하나에 대해서만 작동한다. 그렇기에  원하는 애니메이션을 구해도 타겟팅된 스켈레톤이 다르면 사용할 수 없는데 이런 타겟팅을 바꿀수 있는 것이 리타겟팅이다.</p>

<p>리타겟팅을 하기위해선 스켈레톤의 bone의 규격을 맞춰줘야 한다.</p>

<h3 id="rig-설정">Rig 설정</h3>
<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/937e1c5c-cb71-475a-a29a-7781841bb50e" alt="image" /></p>

<p>서로 다른 스켈레톤간의 리타겟팅을 위한 Rig 규격을 설정해 줘야한다.
애니메이션 스켈레톤 원본인 Source와 해당 스켈레톤으로 변경하고 싶은 Target의 IKRig 두개를 만들어준다.</p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/9793c784-e6fa-4f46-87aa-29b372fb1cfc" alt="스크린샷 2024-04-07 200353" /></p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/fbd2d32d-378a-4d19-a114-12a30fadc140" alt="스크린샷 2024-04-07 200408" /></p>

<p>IK_Rig안에서 원하는 스켈레톤을 지정해준다.</p>

<h2 id="세부설정">세부설정</h2>

<h3 id="루트-설정">루트 설정</h3>
<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/26b6b28a-ed45-4d9d-9edf-32be4e678ec6" alt="스크린샷 2024-04-07 200416" /></p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/9f844a0f-d535-4818-80f5-bd33a20d4d07" alt="image" /></p>

<p>루트를 지정해줘야한다. 루트는 위 처럼 허리부분에 삼각형 표시가 나오는 것으로 지정했다.</p>

<hr />

<h3 id="체인-추가">체인 추가</h3>
<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/11c77e90-f72f-4ea6-bed4-b7e2ddb3ac9d" alt="스크린샷 2024-04-07 200818" /></p>

<p>IK Retargeting탭에서 Add New Chain을 눌러서 라타겟팅 기준이 되는 체인을 생성해준다. 위 과정들은 Source, Target 모두 해준다.</p>

<h2 id="retargeter">Retargeter</h2>

<p>두 IK_Rig를 만들었으면 애니메이션 스켈레톤을 변환할 IK_Retargeter를 만든다.</p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/522f66cc-d612-4f32-aa1a-f2a701c82c6f" alt="스크린샷 2024-04-07 201344" /></p>

<hr />

<p>Source와 Target의 IK_Rig를 설정해 준다.</p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/ebcb994c-bed4-40fa-afef-6ae46410cc38" alt="스크린샷 2024-04-07 201431" /></p>

<hr />

<p>그리고 Asset Browser에서 애니메이션 미리보기를 볼 수 있는데 확인해보면</p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/8123bcb5-5de4-4026-b264-ab7176d935b1" alt="스크린샷 2024-04-07 201614" /></p>

<hr />

<p>애니메이션이 잘 적용 되어있다.
만약 적용했는데 포즈가 많이 엉켜있다면 Detail에서 각 체인별로 IK와 FK를 껏다 켜보면서 맞춰보면 된다.</p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/8559b383-4879-4883-8877-a592f991b92f" alt="스크린샷 2024-04-07 204610" /></p>

<hr />

<p>그리고 AssetBrowser 아래에 있는 ExportSelectedAnimations를 통해 애니메이션을 Export할 수 있다.</p>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/7ea655ce-f110-44cd-9799-5b27d53a42dd" alt="image" /></p>

<h2 id="apos-tpos-변경하기">APos, TPos 변경하기</h2>
<ul>
  <li>스켈레탈 메쉬들은 APos, TPos로 각각 다르다.</li>
  <li>만약 해당 포즈들을 맞춰주지 않고 리타겟팅을 진행한다면 애니메이션이 깨지는 문제가 발생한다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/0aae47b1-a16d-469f-85ee-c1c7b790f15c" alt="image" /></li>
</ul>

<hr />
<h3 id="pos-변경하기">Pos 변경하기</h3>
<h4 id="53-미만-버전">5.3 미만 버전</h4>
<ul>
  <li>IK Retargeter에서 직접 포즈를 수정할 수 있는 것으로 보인다.</li>
  <li>정확히 몇버전부터 안돼는지는 확인필요하다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/804c6179-141b-41c6-9c9b-026cbfcb933d" alt="image" /></li>
</ul>

<h4 id="53-이상">5.3 이상</h4>
<ul>
  <li>SkeletalMesh 혹은 Static Skeleton에셋에 진입해서 원하는 포즈로 변경해준다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/881fd63a-7cb4-423a-9e99-6ace528f52d8" alt="image" /></li>
</ul>

<hr />

<ul>
  <li>상단부분 Create Asset으로 Current Pose를 눌러서 Pose Asset을 만들어준다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/f44438ca-a3d9-47f2-a1e6-1f4ffee759d9" alt="image" /></li>
</ul>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/182b7bfe-8e6a-423e-a71d-e4a41ee41d97" alt="image" /></p>

<hr />

<ul>
  <li>IK Retargeter를 열고 Editing Retarget Pose 모드에서 만들어둔 Pose Asset을 가져온다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/3f197bae-2dbf-44b1-a532-1412c64e25e2" alt="image" /></li>
</ul>

<hr />

<ul>
  <li>
    <p>Current Retarget Pose를 통해서 포즈를 변경해준다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/7a721685-f31b-4637-9e09-fc12c270544e" alt="image" /></p>
  </li>
  <li>
    <p>적용 후
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/c48e7de4-b8bd-4ae0-975b-f53001d3df1a" alt="image" /></p>
  </li>
</ul>

<h2 id="애니메이션이-정확하지-않은데">애니메이션이 정확하지 않은데?</h2>

<ul>
  <li>
    <p>팔이 너무 벌려져 있다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/5377666c-a76d-4ca4-bb7c-c409ac44cf27" alt="image" /></p>
  </li>
  <li>수정 후</li>
  <li>
    <p>팔 간격이 같아졌다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/717c20fd-4b69-4d83-b4d5-3f7798ae145d" alt="image" /></p>
  </li>
  <li>모든 체인의 Rotation Mode를 One to One로 바꾼다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/f93e647b-5fe6-47d2-930b-e6cc88bd9623" alt="image" /></li>
</ul>

<h2 id="공중에-떠있다">공중에 떠있다.</h2>

<ul>
  <li>
    <p>Crouch 모션을 하면 아래처럼 떠있다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/4c90569e-4d87-4412-a56a-1ddc5daaafb0" alt="image" /></p>
  </li>
  <li>
    <p>수정 후
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/1e307783-a762-4420-a5f7-478ae5ba93f6" alt="image" /></p>
  </li>
  <li>
    <p>루트가 포함된 Chain의 TranslationMode를 GloballyScaled로 바꾼다.
<img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/cebb1bc1-f93f-4c32-8cce-f7bda774a4b4" alt="image" /></p>
  </li>
  <li>그리고 애니메이션의 Translation Retargeting을 모두 Animation으로 변경해준다.</li>
  <li>Translation Retargeting
    <ul>
      <li>
        <font color="dodgerred">Animation</font>
        <p> - 애니메이션 데이터에서 비롯되고 변경되지 않는다.</p>
      </li>
      <li>
        <font color="dodgerred">Skeleton</font>
        <p> - 스켈레톤의 bind Pose에 비롯된다.</p>
      </li>
      <li>
        <font color="dodgerred">AnimationScaled</font>
        <p> - 애니메이션 데이터에서 비롯되지만 스켈레톤의 Scale에 따라 비율이 조정된다. 이는 대상 스켈레톤과 소스 스켈레톤의 뼈 길이 사이의 비율이다.</p>
      </li>
    </ul>
  </li>
</ul>

<h4 id="translation-retargeting">Translation Retargeting</h4>
<ul>
  <li>애니메이션은 자신의 기본 스켈레톤 Asset의 데이터를 통해 애니메이션을 수행하려한다.</li>
  <li>Retargeting 데이터를 설정해주지 않으면 애니메이션 데이터를 원래 Skeleton의 Translation data에 적용하려해 에러가 발생할 수 있다.</li>
  <li>하지만 Retargeting한 애니메이션의 경우 자신의 원래 스켈레톤이 아닌 다른 종류의 스켈레톤을 이용해 애니메이션 데이터를 생성했다.</li>
  <li>그래서 Translation Retargeting을 통해 올바른 Skeleton에 애니메이션 데이터를 적용시켜줘야한다.</li>
</ul>

<p><img src="https://github.com/mohitto55/mohitto55.github.io/assets/154340583/006ef724-fc57-4078-a82d-af1de2efb51a" alt="image" /></p>

<div class="Reference">
<div class="callout-header"> </div>
<p>
<a href="https://lunchballer.com/archives/1741">https://lunchballer.com/archives/1741</a>
</p>
</div>
